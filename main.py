import requests
import time
import logging
from bs4 import BeautifulSoup
from telegram import Bot

# Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¨ÙˆØª
TOKEN = "YOUR_BOT_TOKEN"  # Ø§Ø³ØªØ¨Ø¯Ù„Ù‡Ø§ Ø¨ØªÙˆÙƒÙ† Ø§Ù„Ø¨ÙˆØª Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ
CHAT_ID = "YOUR_CHAT_ID"  # Ø§Ø³ØªØ¨Ø¯Ù„Ù‡Ø§ Ø¨Ù…Ø¹Ø±Ù ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù… Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ

# Ø±Ø§Ø¨Ø· ØµÙØ­Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
URL = "https://www.dzrt.com/ar-sa/products"

# ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¨ÙˆØª
bot = Bot(token=TOKEN)

# ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ØªÙŠ ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„ÙŠÙ‡Ø§ Ø³Ø§Ø¨Ù‚Ù‹Ø§
known_products = set()

def get_new_products():
    """Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù…Ù† Ù…ÙˆÙ‚Ø¹ dzrt.com"""
    try:
        response = requests.get(URL, headers={"User-Agent": "Mozilla/5.0"})
        response.raise_for_status()
        soup = BeautifulSoup(response.text, "html.parser")

        # Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª (Ù‚Ø¯ ØªØ­ØªØ§Ø¬ Ù„ØªØ¹Ø¯ÙŠÙ„ Ù‡Ø°Ø§ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù…ÙˆÙ‚Ø¹)
        products = soup.find_all("div", class_="product-item")  # ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„ÙƒÙ„Ø§Ø³ Ø§Ù„ØµØ­ÙŠØ­

        new_products = []
        for product in products:
            title = product.find("h2").text.strip()
            link = product.find("a")["href"]
            full_link = f"https://www.dzrt.com{link}" if not link.startswith("http") else link

            if title not in known_products:
                known_products.add(title)
                new_products.append((title, full_link))

        return new_products

    except requests.RequestException as e:
        logging.error(f"Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹: {e}")
        return []

def send_telegram_message(message):
    """Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø¥Ù„Ù‰ ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…"""
    try:
        bot.send_message(chat_id=CHAT_ID, text=message)
    except Exception as e:
        logging.error(f"Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©: {e}")

def main():
    """ØªØ´ØºÙŠÙ„ Ø§Ù„ÙØ­Øµ ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©"""
    while True:
        new_products = get_new_products()
        if new_products:
            for title, link in new_products:
                send_telegram_message(f"ğŸ”” Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯ Ù…ØªÙˆÙØ±: {title}\nğŸ”— Ø§Ù„Ø±Ø§Ø¨Ø·: {link}")
        time.sleep(60)  # Ø§Ù„ÙØ­Øµ ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©

if _name_ == "_main_":
    main()
